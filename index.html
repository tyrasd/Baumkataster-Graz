<!DOCTYPE html>
<html>
<head>
    <title>Baumkataster Graz</title>

    <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <script src="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="TileLayer.GeoJSON.js"></script>
    <script src="leaflet-hash.js"></script>

    <style type="text/css">
    html, body, #map {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
    }
    </style>
</head>

<body>
    <div id="map"></div>

    <script type="text/javascript">
        var map = new L.Map('map', {
                minZoom:14,
                maxZoom: 19
            }).setView([47.07475, 15.44429], 18);
        var hash = new L.Hash(map);
        
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Karte &copy; <a href="osm.org">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        var style = {
            "clickable": true,
            "color": "#0A2",
            "fillColor": "#0A2",
            "weight": 2.0,
            "opacity": 0.65,
            "fillOpacity": 0.3
        };
        var hoverStyle = {
            "fillOpacity": 0.85,
            "fillColor": "#6F8"
        };
        var geojsonMarkerOptions = {
            radius: 8
        };

        var geojsonURL = './{z}/{x}/{y}.geojson';
        var geojsonTileLayer = new L.TileLayer.GeoJSON(geojsonURL, {
                clipTiles: false,
                unique: function (feature) { 
                    return feature.properties.baumbezeichnung_botanisch;
                },
                minZoom: 16,
                maxZoom: 19,
                tileSize: 512,
                attribution: "Baumkataster &copy; data.graz.gv.at"
            }, {
                style: style,
                onEachFeature: function (feature, layer) {
                    if (feature.properties) {
                        var popupString = '<div class="popup">';
                        for (var k in feature.properties) {
                            var v = feature.properties[k];
                            if (v === null ||
                                k.match(/^marker-/))
                                continue;
                            popupString += k + ': ' + v + '<br />';
                        }
                        popupString += '</div>';
                        layer.bindPopup(popupString);
                    }
                    if (!(layer instanceof L.Point)) {
                        layer.on('mouseover', function () {
                            layer.setStyle(hoverStyle);
                        });
                        layer.on('mouseout', function () {
                            layer.setStyle(style);
                        });
                    }
                },
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, geojsonMarkerOptions);
                }
            }
        );
        map.addLayer(geojsonTileLayer);
    </script>
</body>
</html>