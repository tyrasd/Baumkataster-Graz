<!DOCTYPE html>
<html>
<head>
    <title>Baumkataster Graz</title>

    <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <script src="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="TileLayer.GeoJSON.js"></script>
    <script src="leaflet-hash.js"></script>

    <style type="text/css">
    html, body, #map {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
    }
    </style>
</head>

<body>
    <div id="map"></div>
    <a href="https://github.com/tyrasd/Baumkataster-Graz"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

    <script type="text/javascript">
        var map = new L.Map('map', {
                minZoom:14,
                maxZoom: 19
            }).setView([47.07475, 15.44429], 18);
        var hash = new L.Hash(map);
        
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Karte &copy; <a href="osm.org">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        var style = {
            "clickable": true,
            "color": "#0A2",
            "fillColor": "#0A2",
            "weight": 2.0,
            "opacity": 0.65,
            "fillOpacity": 0.3
        };
        var hoverStyle = {
            "fillOpacity": 0.85,
            "fillColor": "#6F8"
        };
        var geojsonMarkerOptions = {
            radius: 8
        };

        var geojsonURL = './{z}/{x}/{y}.geojson';
        var geojsonTileLayer = new L.TileLayer.GeoJSON(geojsonURL, {
                clipTiles: false,
                /*unique: function (feature) { 
                    //return feature.properties.baumbezeichnung_botanisch;
                    return feature.properties.nummer;
                },*/
                minZoom: 16,
                maxZoom: 19,
                maxNativeZoom: 18,
                tileSize: 512,
                attribution: "Baumkataster &copy; data.graz.gv.at"
            }, {
                style: style,
                onEachFeature: function (feature, layer) {
                    if (feature.properties) {
                        var popupString = '<div class="popup">';
                        for (var k in feature.properties) {
                            var v = feature.properties[k];
                            if (v === null ||
                                k.match(/^marker-/))
                                continue;
                            popupString += k + ': ' + v + '<br />';
                        }
                        popupString += '</div>';
                        layer.bindPopup(popupString);
                    }
                    if (!(layer instanceof L.Point)) {
                        layer.on('mouseover', function () {
                            //layer.setStyle(hoverStyle);
                            for (var k in geojsonTileLayer.geojsonLayer._layers) {
                                var l = geojsonTileLayer.geojsonLayer._layers[k];
                                if (l.feature.properties.baumbezeichnung_botanisch === feature.properties.baumbezeichnung_botanisch)
                                    l.setStyle(hoverStyle);
                            }
                        });
                        layer.on('mouseout', function () {
                            //layer.setStyle(style);
                            for (var k in geojsonTileLayer.geojsonLayer._layers) {
                                var l = geojsonTileLayer.geojsonLayer._layers[k];
                                if (l.feature.properties.baumbezeichnung_botanisch === feature.properties.baumbezeichnung_botanisch)
                                    l.setStyle(style);
                            }
                        });
                    }
                },
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, geojsonMarkerOptions);
                }
            }
        );
        map.addLayer(geojsonTileLayer);
    </script>
</body>
</html>
